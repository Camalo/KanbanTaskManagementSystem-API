# Kanban task management system API

***Кратко.*** Это веб-API для управления проектами и задачами в стиле Kanban.
Каждый пользователь работает только в проектах, где он — участник. Задачи отображаются по статусам (Новая, В работе, Готово) и сортируются по приоритету. Система поддерживает JWT-аутентификацию, расчёт базовой аналитики (прогресс, среднее время выполнения, просрочки), историю изменений задач и полнотекстовый поиск через Elasticsearch (опционально).

## Функционал

##### Аутентификация / авторизация

- Регистрация пользователя.

- Вход (login) и выдача JWT (access / refresh токены).

- Ограничение попыток входа (RateLimiter).

- Авторизованному пользователю видны только проекты, в которых он участник (Voters в UseCase).

##### Управление проектами

- Создание проекта.

- Удаление проекта.

- Просмотр списка проектов.

- Добавление участника в проект (AddMember).

##### Управление задачами (Kanban)

- Создание, обновление, удаление задачи.

- Изменение статуса задачи (PATCH для смены статуса).

- Владелец задачи — автоматически при создании.

- Исполнитель может быть задан при создании/обновлении.

- API отдаёт JSON для Kanban-доски:

    - группировка по статусам (каналы),

    - сортировка внутри канала по приоритету,

    - фильтрация по status / priority / dueDate.

- Метаданные: dueDate, priority, createdAt, updatedAt, completedAt.

##### Аналитика / Метрики

- Процент завершённых задач в проекте.

- Среднее время выполнения задач (created → completed).

- Количество просроченных задач (по dueDate).

## Инфраструктурные фичи

TaskHistory — отдельная сущность для логов изменений задач (postPersist/postUpdate listener).

Централизованная обработка исключений — ExceptionListener (ответы по RFC 7807).

Валидация JSON запросов через ValidateJsonListener.

Elasticsearch для полнотекстового поиска (опционально).

Docker-окружение (Postgres, Redis, Elasticsearch, nginx / php-fpm).

## Endpoints (роуты)

##### Аутентификация, авторизация и регистрация (2)

| Функция                  | Метод | Endpoint             |
| ------------------------ | ----- | -------------------- |
| Регистрация пользователя | POST  | `/api/auth/register` |
| Вход пользователя        | POST  | `/api/auth/login`    |


##### Управление проектами (4)

| Функция                                                               | Метод  | Endpoint                            |
| --------------------------------------------------------------------- | ------ | ----------------------------------- |
| Создание проекта, доступно пользователю с ролью менеджер              | POST   | `/api/projects`                     |
| Удаление проекта, доступно пользователю с ролью менеджер              | DELETE | `/api/projects/{projectId}`         |
| Просмотр списка проектов                                              | GET    | `/api/projects`                     |
| Добавление участника в проект, доступно пользователю с ролью менеджер | POST   | `/api/projects/{projectId}/members` |


##### Управление задачами (6)

| Функция                                               | Метод  | Endpoint                                                                                |
| ----------------------------------------------------- | ------ | --------------------------------------------------------------------------------------- |
| Просмотр списка задач, доступно участнику проекта     | GET    | `/api/projects/{projectId}/tasks`<br><br>параметры:<br>`priority=high`<br>`status=done` |
| Создание задачи, доступно участнику проекта           | POST   | `/api/projects/{projectId}/tasks`                                                       |
| Обновление задачи, доступно участнику проекта         | PUT    | `/api/projects/{projectId}/tasks/{id}`                                                  |
| Обновление статуса задачи, доступно участнику проекта | PATCH  | `/api/projects/{projectId}/tasks/{id}/status`                                           |
| Удаление задачи, доступно участнику проекта           | DELETE | `/api/projects/{projectId}/tasks/{id}`                                                  |
| Просмотр задачи детально, доступно участнику проекта  | GET    | `/api/projects/{projectId}/tasks/{id}`                                                  |


##### Поиск и история задач (2)

| Функция                                                       | Метод | Endpoint                                       |
| ------------------------------------------------------------- | ----- | ---------------------------------------------- |
| Поиск задачи                                                  | GET   | `/api/search?query=...`                        |
| Просмотр истории изменения задачи, доступно участнику проекта | GET   | `/api/projects/{projectId}/tasks/{id}/history` |


##### Аналитика и метрики (3)

| Функция                         | Метод | Endpoint                                          |
| ------------------------------- | ----- | ------------------------------------------------- |
| Процент завершённых задач       | GET   | `/api/analytics/projects/{projectId}/progress`    |
| Среднее время выполнения задачи | GET   | `/api/analytics/projects/{projectId}/performance` |
| Количество просроченных задач   | GET   | `/api/analytics/projects/{projectId}/overdue`     |


## Быстрый старт (локальная разработка, Docker)

**Требования**

- Docker & Docker Compose (версия compose V2 рекомендуется)
- PHP 8.1+ (локально, опционально)
- Composer (локально, если не используете контейнер для composer)

**1. Подготовка `.env`**

- В корне проекта рядом с `docker-compose.yaml` нужен `.env` файл (см. пример `.env.example`).

**2. Запуск контейнеров**

``` bash
docker compose up -d --build
```

**3. Установка зависимостей (если нужно)** 

Если используете контейнер app для выполнения composer:

``` bash
docker compose exec app composer install
```

Или локально:

``` bash
composer install
```

**4. Миграции (в контейнере)**

``` bash
docker compose exec app php bin/console doctrine:migrations:migrate --no-interaction
```

**5. Настройка ключей JWT (если ещё не сгенерированы)**  

``` bash
docker compose exec app php bin/console lexik:jwt:generate-keypair
```

*Если вы генерируете в первый раз, то не забудьте проверить права доступа на сгенерированные папки.*

**6. Создать индекс в Elasticsearch**

``` bash
curl -u elastic:${ELASTIC_PASSWORD} -XPUT "http://localhost:9200/tasks" -H 'Content-Type: application/json' -d '{ "settings": { ... }, "mappings": { ... } }'
```